# 重构回归：手工烟测清单（Step 0 基线）

> 目的：把“当前行为”固化成可执行的验收清单，保证每一步重构都能独立验证，降低回归概率。
>
> 适用范围：对齐 `docs/rebuild.md` 的 Step 0~14；每次合入都至少跑一遍本清单的「最低集」。

## 0. 关键文件体积基线（记录用）

> 说明：用于后续“瘦身”验收参考（行数来自当前仓库基线）。

- `app/src/main/java/blbl/cat3399/core/api/BiliApi.kt`：2813 行（God Object）
- `app/src/main/java/blbl/cat3399/feature/search/SearchFragment.kt`：1591 行
- `app/src/main/java/blbl/cat3399/feature/settings/SettingsActivity.kt`：1606 行
- `app/src/main/java/blbl/cat3399/ui/MainActivity.kt`：964 行

## 1. 构建/安装（最低要求）

- 构建 Debug：
  - `./gradlew :app:assembleDebug`
- （可选）安装到设备/模拟器：
  - `adb install -r app/build/outputs/apk/debug/app-debug.apk`

## 2. 冷启动 + 侧边栏导航（最低集）

1) 冷启动 App，确认能进入 `MainActivity`，无崩溃/ANR。
2) 使用 D-pad/遥控器操作侧边栏，依次切到并确认可见内容区域正常刷新：
   - Home
   - Category
   - Dynamic
   - Live
   - Search
   - My
3) 返回键链路（只做最小检查）：
   - 若有弹层/overlay：优先关闭弹层
   - 其次 backstack 返回
   - 最后退出（如有 DoubleBackToExit 行为，按现状验证）

## 3. Search（关键路径）

> 目标：覆盖输入 → 结果 → 多 Tab → 刷新 → 翻页，并对并发一致性做压力操作。

1) 进入 Search 页面，焦点能正常落在输入区域或推荐区域（按现状）。
2) 输入关键字并提交：
   - 能出结果列表
   - 切换 2~3 个 Tab（例如：综合/视频/番剧/用户等，以页面实际为准）
3) 刷新：
   - 下拉刷新可用（或按现状的刷新触发方式）
   - 刷新后结果不为空时，列表仍可继续滚动
4) 翻页加载更多：
   - 滚动到底触发加载更多
   - 加载更多后焦点仍停留在网格区域，并能继续向下移动到新行
5) 并发一致性压力（必须做）：
   - 在“加载中”快速切换 Tab + 立刻刷新（重复 3 次）
   - 预期：不会出现旧 Tab 的结果覆盖新 Tab；不会出现 loading 卡死；不会出现明显重复追加

## 4. Settings（关键路径）

> 目标：覆盖“点击分发”与常见弹窗/开关，保证改文案不影响逻辑（后续 Step 8/9 的重点）。

1) 从侧边栏进入 Settings，进入后无崩溃，左右栏焦点可正常切换。
2) 逐项点击/切换关键设置（以实际页面为准，至少覆盖以下类型）：
   - 开关类：开/关后 UI 状态与功能保持一致
   - 弹窗类：弹窗能打开、确认/取消能正确关闭并落焦
   - 清理/重置类：执行后 toast/提示正常、无异常崩溃
   - 导出/日志类：可触发流程且不崩溃（结果文件是否生成可按现状人工确认）
3) 焦点记忆/恢复（最小检查）：
   - 左右栏来回切换，焦点不“丢失”
   - 返回再进入，焦点行为与现状一致

## 5. Video / Live / My（列表分页链路）

> 目标：覆盖 Step 1/2 的分页状态机替换点：首屏、刷新、翻页、并发一致性、加载更多后的焦点体验。

### 5.1 Video（列表页）

1) 进入视频列表页（推荐/热门/分区等，以现状入口为准），首屏自动加载成功。
2) 下拉刷新（或按现状刷新方式）：
   - 刷新后列表更新且不乱序/不清空卡死
3) 滚动到底触发加载更多：
   - 能追加更多内容
   - 加载更多后焦点仍在网格内，能移动到新增行
4) 并发压力：
   - “加载中”连续触发刷新 2~3 次
   - 若页面支持切换 source：加载中切换 source 并刷新
   - 预期：不出现旧数据覆盖新数据、不出现 loading 状态卡死

### 5.2 Live（列表页）

1) 进入直播列表页，首屏自动加载成功。
2) 刷新 + 翻页加载更多与 Video 同样验证。
3) 若有“推荐/关注”等 source：
   - 快速切换 source 并刷新
   - 预期：不会把旧 source 的请求结果追加到新 source

### 5.3 My（历史/追番等）

1) 进入 My 的列表页（历史、追番等），首屏自动加载成功（需登录态则按现状处理）。
2) 刷新后可继续翻页加载更多。
3) 并发压力：
   - 加载中快速刷新/切换 Tab（如有）
   - 预期：不出现“刷新后又被旧请求覆盖”的回写；不出现 loading 卡死

## 6. 日志与错误（兜底）

- 失败提示可见：网络失败时 toast/提示仍存在（按现状文案）。
- Logcat 不出现新增致命崩溃（建议过滤 Tag：`BLBL`）。

